<!DOCTYPE html>
<html lang="en" data-theme="light">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Universe - Sign Up</title>
    <link rel="stylesheet" href="sign-up1.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <style>
      .terms-container {
        position: relative;
        margin-top: 20px;
      }

      .terms-link {
        color: blue;
        text-decoration: underline;
        cursor: pointer;
      }

      .terms-dropdown {
        display: none;
        position: absolute;
        right: 0;
        width: 300px;
        max-height: 200px;
        overflow-y: auto;
        background-color: #f9f9f9;
        border: 1px solid #ddd;
        box-shadow: 0px 8px 16px 0px rgba(0, 0, 0, 0.2);
        z-index: 1;
        padding: 10px;
      }

      .terms-dropdown .terms-content h2 {
        margin-top: 0;
      }

      .terms-dropdown button {
        margin-top: 10px;
      }

      .interests-container {
        margin-top: 20px;
        padding: 15px;
        border: 1px solid #ddd;
        border-radius: 8px;
        background-color: #f5f5f5;
      }

      .interests-container h3 {
        margin: 0 0 10px 0;
        font-size: 18px;
      }

      .interests-container label {
        display: flex;
        align-items: center;
        margin-bottom: 8px;
        font-size: 15px;
        cursor: pointer;
      }

      .interests-container input[type="checkbox"] {
        margin-right: 8px;
        transform: scale(1.2);
      }
    </style>
  </head>
  <body>
    <div class="theme-switch">
      <i class="fas fa-moon"></i>
    </div>
    <div class="form-container">
      <p class="title">Create An Account</p>
      <form class="form" id="registrationForm">
        <div class="terms-container">
          <label for="agreeTerms">
            <input type="checkbox" id="agreeTerms" name="agreeTerms" required />
            I agree to the
            <span class="terms-link" onclick="toggleTermsDropdown()"
              >Terms and Conditions</span
            >
          </label>

          <div class="terms-dropdown" id="termsDropdown">
            <div class="terms-content">
              <h2>Terms and Conditions</h2>
              <p>
                Lorem ipsum dolor sit amet, consectetur adipiscing elit. ...
                (Your full terms and conditions text here)
              </p>
              <button onclick="toggleTermsDropdown()">Close</button>
            </div>
          </div>

          <div class="interests-container">
            <h3>Area Of Interests</h3>

            <label>
              <input type="checkbox" name="interests" value="shopping" />
              Shopping
            </label>

            <label>
              <input type="checkbox" name="interests" value="socialmedia" />
              Social Media
            </label>

            <label>
              <input type="checkbox" name="interests" value="payments" />
              Payments
            </label>
          </div>
        </div>

        <button type="submit" class="form-btn">Sumbit</button>
      </form>
    </div>
    <script src="passwordchecker.js"></script>
    <script>
      // Load saved data when page loads
      window.addEventListener('load', function() {
        const savedData = JSON.parse(localStorage.getItem('userRegistrationData') || '{}');
        
        // If registration is already complete, clear the form for new registration
        if (savedData.registrationComplete) {
          // Clear all form fields
          document.getElementById("agreeTerms").checked = false;
          
          // Clear all interest checkboxes
          document.querySelectorAll('input[name="interests"]').forEach(checkbox => {
            checkbox.checked = false;
          });
          
          // Clear the temporary registration data to start fresh
          localStorage.removeItem('userRegistrationData');
          return;
        }
        
        // Load saved data for incomplete registration
        if (savedData.agreeTerms) {
          document.getElementById("agreeTerms").checked = savedData.agreeTerms;
        }
        
        if (savedData.interests && Array.isArray(savedData.interests)) {
          savedData.interests.forEach(interest => {
            const checkbox = document.querySelector(`input[name="interests"][value="${interest}"]`);
            if (checkbox) {
              checkbox.checked = true;
            }
          });
        }
      });

      document.getElementById("registrationForm").addEventListener("submit", function (e) {
        e.preventDefault();

        const agreeTerms = document.getElementById("agreeTerms").checked;
        const interests = Array.from(document.querySelectorAll('input[name="interests"]:checked'))
          .map(checkbox => checkbox.value);

        if (agreeTerms && interests.length > 0) {
          // Get existing data from local storage
          const existingData = JSON.parse(localStorage.getItem('userRegistrationData') || '{}');
          
          // Add new data to existing data
          const userData = {
            ...existingData,
            agreeTerms: agreeTerms,
            interests: interests,
            registrationComplete: true,
            registrationDate: new Date().toISOString()
          };
          
          // Get all existing accounts from local storage
          const allAccounts = JSON.parse(localStorage.getItem('allUserAccounts') || '[]');
          
          // Check if user with this email already exists
          const existingUserIndex = allAccounts.findIndex(account => account.email === userData.email);
          
          if (existingUserIndex !== -1) {
            // Update existing user account
            allAccounts[existingUserIndex] = {
              fullName: userData.fullName,
              username: userData.username,
              email: userData.email,
              dob: userData.dob,
              gender: userData.gender,
              phoneNumber: userData.phoneNumber,
              address: userData.address,
              password: userData.password,
              agreeTerms: userData.agreeTerms,
              interests: userData.interests,
              registrationComplete: userData.registrationComplete,
              registrationDate: userData.registrationDate
            };
          } else {
            // Add new user account
            allAccounts.push({
              fullName: userData.fullName,
              username: userData.username,
              email: userData.email,
              dob: userData.dob,
              gender: userData.gender,
              phoneNumber: userData.phoneNumber,
              address: userData.address,
              password: userData.password,
              agreeTerms: userData.agreeTerms,
              interests: userData.interests,
              registrationComplete: userData.registrationComplete,
              registrationDate: userData.registrationDate
            });
          }
          
          // Save all accounts back to local storage
          localStorage.setItem('allUserAccounts', JSON.stringify(allAccounts));
          
          // Show success message with user data
          alert('Registration completed successfully! Welcome to Universe!');
          
          // Clear temporary registration data
          localStorage.removeItem('userRegistrationData');
          
          window.location.href = "firstpage.html";
        } else {
          if (!agreeTerms) {
            alert("Please agree to the Terms and Conditions!");
          } 
        }
      });
    </script>
    <script>
      function toggleTermsDropdown() {
        var dropdown = document.getElementById("termsDropdown");
        if (dropdown.style.display === "block") {
          dropdown.style.display = "none";
        } else {
          dropdown.style.display = "block";
        }
      }
    </script>
    <script src="userDataManager.js"></script>
    <script src="theme.js"></script>
  </body>
</html>
